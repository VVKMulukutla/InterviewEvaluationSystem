<!--record.html-->
<!DOCTYPE html>
<html>
<head>
    <title>Record Audio</title>
    <script src="https://cdn.jsdelivr.net/npm/recordrtc/RecordRTC.js"></script>
</head>
<body>
    <h1>Record Audio</h1>
    <p id="question">Question: {{ question }}</p>
    <button id="start" onclick="startRecording()">Start Recording</button>
    <button id="stop" onclick="stopRecording()">Stop Recording</button>
    <button id="rerecord" onclick="rerecordAudio()" disabled>Rerecord</button>

    <button id="upload" onclick="uploadRecording()">Upload Recording</button>
    <div id="status"></div>
    <div id="audio-container"></div>

    <script>
        var recorder;
        var audioContainer = document.getElementById('audio-container');
        var statusElement = document.getElementById('status');
        var mimeType = 'audio/wav';
 // Set the desired audio format
 function rerecordAudio() {
    audioContainer.innerHTML = ''; // Clear the previously recorded audio
    document.getElementById('upload').disabled = true;
    document.getElementById('rerecord').disabled = true;
    document.getElementById('start').disabled = false;
    statusElement.innerHTML = '';
}

function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function (stream) {
            recorder = new RecordRTC(stream, { type: 'audio', mimeType: mimeType, sampleRate: 16000 });
            recorder.startRecording();
            statusElement.innerHTML = 'Recording...';
            document.getElementById('start').disabled = true;
            document.getElementById('rerecord').disabled = true;
            document.getElementById('stop').disabled = false;
        })
        .catch(function (error) {
            console.error('Error accessing microphone:', error);
        });
}


        function stopRecording() {
    recorder.stopRecording(function () {
        statusElement.innerHTML = 'Recording stopped.';
        var blob = recorder.getBlob();
        var audioElement = document.createElement('audio');
        audioElement.controls = true;
        audioElement.src = URL.createObjectURL(blob);
        audioContainer.appendChild(audioElement);
        document.getElementById('stop').disabled = true;
        document.getElementById('upload').disabled = false;
        document.getElementById('rerecord').disabled = false; // Enable the "Rerecord" button
    });
}


        function uploadRecording() {
            recorder.getDataURL(function (dataURL) {
                var formData = new FormData();
                var blob = recorder.getBlob();
                formData.append('audio', blob, 'rec.mp3'); // Set the desired file extension

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(function (response) {
                    return response.text();
                })
                .then(function (text) {
                    console.log(text);
                    alert('Audio uploaded successfully!');
                })
                .catch(function (error) {
                    console.error('Error uploading audio:', error);
                });
            });
        }
    </script>
</body>
</html>
